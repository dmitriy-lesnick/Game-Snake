window.onload=init;let FIELD_SIZE_X=20,FIELD_SIZE_Y=20,SNAKE_SPEED=200,snake=[],direction="y+",gameIsRunning=!1,snake_timer,food_timer,score=0,record=0,newRecord=document.querySelector(".record");function init(){prepareGameField();let e=document.getElementsByClassName("wrap")[0];e.style.width="1000px",document.getElementById("snake-start").addEventListener("click",startGame),document.getElementById("snake-renew").addEventListener("click",refreshGame),addEventListener("keydown",changeDirection)}function prepareGameField(){let e=document.createElement("table");e.setAttribute("class","game-table ");for(let s=0;s<FIELD_SIZE_X;s++){let n=document.createElement("tr");n.className="game-table-row row-"+s;for(let t=0;t<FIELD_SIZE_Y;t++){let e=document.createElement("td");e.className="game-table-cell cell-"+s+"-"+t,n.appendChild(e)}e.appendChild(n)}document.getElementById("snake-field").appendChild(e)}function startGame(){gameIsRunning=!0;let e=document.querySelector(".audio-start");e.play(),e.volume=.25,respawn(),snake_timer=setInterval(move,SNAKE_SPEED),setTimeout(createFood,1e3),setTimeout(createBomb,1e3),this.classList.add("display-none"),document.querySelector(".score-wrp").classList.remove("display-none"),document.querySelector(".score").innerText=0}function respawn(){var e=Math.floor(FIELD_SIZE_X/2),t=Math.floor(FIELD_SIZE_Y/2);let n=document.getElementsByClassName("cell-"+t+"-"+e)[0];n.setAttribute("class",n.getAttribute("class")+" snake-unit");let s=document.getElementsByClassName("cell-"+(t-1)+"-"+e)[0];s.setAttribute("class",s.getAttribute("class")+" snake-unit"),snake.push(n),snake.push(s)}function move(){let e=snake[snake.length-1].getAttribute("class").split(" "),t;var n=e[1].split("-"),s=parseInt(n[1]),o=parseInt(n[2]);if("x-"==direction?t=document.getElementsByClassName("cell-"+s+"-"+(o-1))[0]:"x+"==direction?t=document.getElementsByClassName("cell-"+s+"-"+(o+1))[0]:"y+"==direction?t=document.getElementsByClassName("cell-"+(s-1)+"-"+o)[0]:"y-"==direction&&(t=document.getElementsByClassName("cell-"+(s+1)+"-"+o)[0]),null==t)switch(direction){case"x-":t=document.getElementsByClassName("cell-"+s+"-"+(FIELD_SIZE_X-1))[0];break;case"x+":t=document.getElementsByClassName("cell-"+s+"-0")[0];break;case"y+":t=document.getElementsByClassName("cell-"+(FIELD_SIZE_Y-1)+"-"+o)[0];break;case"y-":t=document.getElementsByClassName("cell-0-"+o)[0]}if(isSnakeUnit(t)||isBombUnit(t)){let e=document.querySelector(".audio-game-over");e.play(),e.volume=.5,finishTheGame()}else if(t.setAttribute("class",t.getAttribute("class")+" snake-unit"),snake.push(t),!haveFood(t)){let e=snake.splice(0,1)[0];n=e.getAttribute("class").split(" ");e.setAttribute("class",n[0]+" "+n[1])}haveBonus(t)&&(document.querySelector(".bonus-unit").classList.remove("bonus-unit"),score+=10,document.querySelector(".score").innerText=score)}function isSnakeUnit(e){let t=!1;return snake.includes(e)&&(t=!0),t}function isBombUnit(e){let t=!1,n=e.getAttribute("class").split(" ");return n.includes("bomb-unit")&&(t=!0),t}function haveFood(e){let t=!1,n=e.getAttribute("class").split(" ");return n.includes("food-unit")&&(t=!0,document.querySelector(".audio-food").play(),document.querySelector(".food-unit").classList.remove("food-unit"),createFood(),createBomb(),score++,5!=score&&30!=score&&50!=score&&70!=score||(document.querySelector(".bonus").play(),document.querySelector(".bonus").volume=.5,createBonus()),document.querySelector(".score").innerText=score),t}function createFood(){let s=!1;for(;!s;){var t=Math.floor(Math.random()*FIELD_SIZE_X),o=Math.floor(Math.random()*FIELD_SIZE_Y);let e=document.getElementsByClassName("cell-"+o+"-"+t)[0],n=e.getAttribute("class").split(" ");if(!n.includes("snake-unit")&&!n.includes("bomb-unit")&&!n.includes("bonus-unit")){let t="";for(let e=0;e<n.length;e++)t+=n[e]+" ";e.setAttribute("class",t+"food-unit"),s=!0}}}function haveBonus(e){let t=!1,n=e.getAttribute("class").split(" ");return n.includes("bonus-unit")&&(t=!0,document.querySelector(".pick-up-bonus").play(),document.querySelector(".pick-up-bonus").volume=.5),t}function createBonus(){let s=!1;for(;!s;){var t=Math.floor(Math.random()*FIELD_SIZE_X),o=Math.floor(Math.random()*FIELD_SIZE_Y);let e=document.getElementsByClassName("cell-"+o+"-"+t)[0],n=e.getAttribute("class").split(" ");if(!n.includes("snake-unit")&&!n.includes("bomb-unit")&&!n.includes("food-unit")){let t="";for(let e=0;e<n.length;e++)t+=n[e]+" ";e.setAttribute("class",t+"bonus-unit"),s=!0}}}function createBomb(){let s=!1;for(;!s;){var t=Math.floor(Math.random()*(FIELD_SIZE_X-1-1)+1),o=Math.floor(Math.random()*(FIELD_SIZE_Y-1-1)+1);let e=document.getElementsByClassName("cell-"+o+"-"+t)[0],n=e.getAttribute("class").split(" ");if(!n.includes("snake-unit")&&!n.includes("food-unit")&&!n.includes("bonus-unit")){let t="";for(let e=0;e<n.length;e++)t+=n[e]+" ";e.setAttribute("class",t+"bomb-unit"),s=!0}}}function changeDirection(e){switch(e.keyCode){case 37:"x+"!=direction&&(direction="x-");break;case 38:"y-"!=direction&&(direction="y+");break;case 39:"x-"!=direction&&(direction="x+");break;case 40:"y+"!=direction&&(direction="y-")}}function finishTheGame(){gameIsRunning=!1,clearInterval(snake_timer);let e=document.querySelector(".score-game-over");e.classList.add("margin"),e.innerText="Вы проиграли, общее колличество очков - "+score,document.querySelector("#snake-renew").classList.remove("display-none"),document.querySelector(".score-wrp").classList.add("display-none"),score>record&&(newRecord.innerText=" "+score,localStorage.setItem("record",JSON.stringify(score)))}function refreshGame(){location.reload()}localStorage.getItem("record")&&(record=JSON.parse(localStorage.getItem("record")),newRecord.innerText=" "+record);